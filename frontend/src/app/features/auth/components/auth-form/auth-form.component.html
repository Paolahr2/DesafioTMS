<div class="auth-container">
  <!-- Animated gradient background -->
  <div class="animated-background"></div>

  <!-- Centered card with animation -->
  <div class="auth-card-container">
    <div class="auth-card">
      <!-- Logo and title -->
      <div class="card-header">
        <div class="logo-section">
          <div class="logo-icon">TM</div>
          <h1 class="brand-title">TaskManager</h1>
        </div>
        <p class="card-subtitle">Gestiona tus tareas de manera eficiente</p>
      </div>

      <!-- Material Tabs for Sign In / Sign Up -->
      <mat-tab-group class="auth-tabs" animationDuration="300ms" [(selectedIndex)]="selectedTabIndex">
        <!-- Sign In Tab -->
        <mat-tab label="Iniciar Sesión">
          <div class="tab-content">
            <div class="tab-description">
              <h3 class="tab-title">¡Bienvenido de vuelta!</h3>
              <p class="tab-subtitle">Ingresa tus credenciales para acceder a tu cuenta</p>
            </div>

            <form [formGroup]="loginForm" (ngSubmit)="onLogin()" class="auth-form">
              <!-- Error messages -->
              <div *ngIf="loginErrors.length > 0" class="error-messages">
                <mat-icon class="error-icon">error_outline</mat-icon>
                <div class="error-list">
                  <div *ngFor="let error of loginErrors" class="error-item">{{ error }}</div>
                </div>
              </div>

              <!-- Email/Username field -->
              <mat-form-field class="auth-input" appearance="outline">
                <mat-label>Correo electrónico o usuario</mat-label>
                <input matInput formControlName="emailOrUsername" type="text" placeholder="usuario@ejemplo.com">
                <mat-icon matPrefix>person</mat-icon>
                <mat-error *ngIf="loginForm.get('emailOrUsername')?.invalid && submittedLogin">
                  <span *ngIf="loginForm.get('emailOrUsername')?.errors?.['required']">Este campo es obligatorio</span>
                </mat-error>
              </mat-form-field>

              <!-- Password field -->
              <mat-form-field class="auth-input" appearance="outline">
                <mat-label>Contraseña</mat-label>
                <input matInput formControlName="password" [type]="showPassword ? 'text' : 'password'" placeholder="Tu contraseña">
                <mat-icon matPrefix>lock</mat-icon>
                <button mat-icon-button matSuffix (click)="showPassword = !showPassword" type="button">
                  <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                <mat-error *ngIf="loginForm.get('password')?.invalid && submittedLogin">
                  <span *ngIf="loginForm.get('password')?.errors?.['required']">La contraseña es obligatoria</span>
                </mat-error>
              </mat-form-field>

              <!-- Login button -->
              <button mat-raised-button class="auth-button" type="submit" [disabled]="isLoadingLogin">
                <mat-icon *ngIf="!isLoadingLogin">login</mat-icon>
                <mat-icon *ngIf="isLoadingLogin" class="spinning">refresh</mat-icon>
                {{ isLoadingLogin ? 'Iniciando sesión...' : 'Iniciar Sesión' }}
              </button>

              <!-- Link to register -->
              <div class="auth-links">
                <span>¿No tienes cuenta? </span>
                <button type="button" class="auth-link" (click)="switchToRegister()">Regístrate aquí</button>
              </div>
            </form>
          </div>
        </mat-tab>

        <!-- Sign Up Tab -->
        <mat-tab label="Registrarse">
          <div class="tab-content">
            <div class="tab-description">
              <h3 class="tab-title">Crea tu cuenta</h3>
              <p class="tab-subtitle">Únete a TaskManager y comienza a organizar tus tareas</p>
            </div>

            <form [formGroup]="registerForm" (ngSubmit)="onRegister()" class="auth-form">
              <!-- Error messages -->
              <div *ngIf="registerErrors.length > 0" class="error-messages">
                <mat-icon class="error-icon">error_outline</mat-icon>
                <div class="error-list">
                  <div *ngFor="let error of registerErrors" class="error-item">{{ error }}</div>
                </div>
              </div>

              <!-- Username field -->
              <mat-form-field class="auth-input" appearance="outline">
                <mat-label>Nombre de usuario</mat-label>
                <input matInput formControlName="username" type="text" placeholder="Elige un nombre de usuario">
                <mat-icon matPrefix>account_circle</mat-icon>
                <mat-error *ngIf="registerForm.get('username')?.invalid && submittedRegister">
                  <span *ngIf="registerForm.get('username')?.errors?.['required']">El nombre de usuario es obligatorio</span>
                  <span *ngIf="registerForm.get('username')?.errors?.['minlength']">Mínimo 3 caracteres</span>
                </mat-error>
              </mat-form-field>

              <!-- First Name field -->
              <mat-form-field class="auth-input" appearance="outline">
                <mat-label>Nombre</mat-label>
                <input matInput formControlName="firstName" type="text" placeholder="Tu nombre">
                <mat-icon matPrefix>person</mat-icon>
                <mat-error *ngIf="registerForm.get('firstName')?.invalid && submittedRegister">
                  <span *ngIf="registerForm.get('firstName')?.errors?.['required']">El nombre es obligatorio</span>
                </mat-error>
              </mat-form-field>

              <!-- Last Name field -->
              <mat-form-field class="auth-input" appearance="outline">
                <mat-label>Apellido</mat-label>
                <input matInput formControlName="lastName" type="text" placeholder="Tu apellido">
                <mat-icon matPrefix>person</mat-icon>
                <mat-error *ngIf="registerForm.get('lastName')?.invalid && submittedRegister">
                  <span *ngIf="registerForm.get('lastName')?.errors?.['required']">El apellido es obligatorio</span>
                </mat-error>
              </mat-form-field>

              <!-- Email field -->
              <mat-form-field class="auth-input" appearance="outline">
                <mat-label>Correo electrónico</mat-label>
                <input matInput formControlName="email" type="email" placeholder="tu@correo.com">
                <mat-icon matPrefix>email</mat-icon>
                <mat-error *ngIf="registerForm.get('email')?.invalid && submittedRegister">
                  <span *ngIf="registerForm.get('email')?.errors?.['required']">El correo es obligatorio</span>
                  <span *ngIf="registerForm.get('email')?.errors?.['email']">Ingresa un correo válido</span>
                </mat-error>
              </mat-form-field>

              <!-- Password field -->
              <mat-form-field class="auth-input" appearance="outline">
                <mat-label>Contraseña</mat-label>
                <input matInput formControlName="password" [type]="showPassword ? 'text' : 'password'" placeholder="Crea una contraseña segura">
                <mat-icon matPrefix>lock</mat-icon>
                <button mat-icon-button matSuffix (click)="showPassword = !showPassword" type="button">
                  <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                <mat-error *ngIf="registerForm.get('password')?.invalid && submittedRegister">
                  <span *ngIf="registerForm.get('password')?.errors?.['required']">La contraseña es obligatoria</span>
                  <span *ngIf="registerForm.get('password')?.errors?.['minlength']">Mínimo 6 caracteres</span>
                </mat-error>
              </mat-form-field>

              <!-- Confirm Password field -->
              <mat-form-field class="auth-input" appearance="outline">
                <mat-label>Confirmar contraseña</mat-label>
                <input matInput formControlName="confirmPassword" [type]="showConfirmPassword ? 'text' : 'password'" placeholder="Repite tu contraseña">
                <mat-icon matPrefix>lock</mat-icon>
                <button mat-icon-button matSuffix (click)="showConfirmPassword = !showConfirmPassword" type="button">
                  <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
                <mat-error *ngIf="registerForm.get('confirmPassword')?.invalid && submittedRegister">
                  <span *ngIf="registerForm.get('confirmPassword')?.errors?.['required']">La confirmación es obligatoria</span>
                  <span *ngIf="registerForm.get('confirmPassword')?.errors?.['passwordMismatch']">Las contraseñas no coinciden</span>
                </mat-error>
              </mat-form-field>

              <!-- Register button -->
              <button mat-raised-button class="auth-button" type="submit" [disabled]="isLoadingRegister">
                <mat-icon *ngIf="!isLoadingRegister">person_add</mat-icon>
                <mat-icon *ngIf="isLoadingRegister" class="spinning">refresh</mat-icon>
                {{ isLoadingRegister ? 'Creando cuenta...' : 'Crear Cuenta' }}
              </button>

              <!-- Link to login -->
              <div class="auth-links">
                <span>¿Ya tienes cuenta? </span>
                <button type="button" class="auth-link" (click)="switchToLogin()">Inicia sesión aquí</button>
              </div>
            </form>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>
